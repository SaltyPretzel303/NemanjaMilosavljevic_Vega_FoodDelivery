# Vega Delivery by Nemanja Milosavljevic 

This app consists of next modules: 
- Backend - Backend exposing HTTP REST API  written in python using FastAPI and SqlAlchemy coupled with sqlite for data persistance.
- Supertokens - Authentication solution used by both frontend and backend. 
- Frontend - Web application developed using React. 

Everything can be set up by running `docker compose up` while inside the root of the project. 
This command will build all the necessary images, create `bridge` type network `vega-net` and start next containers inside of it:
- web.vega - Container hosting react web application. 
- tokens-core.vega - Part of the Supertokens authentication solution, exposing HTTP REST API.
- tokens-db.vega - Postgres database used by the tokens-core.vega service. 
- backend.vega - Backend application exposing HTTP REST API for CRUD operations on chains, restaurants, couriers and menu items. Database used by the `backend.vega` service is sqlite in-file database. To keep the data after the container restart `local.db` file should be mounted as a volume using commented section inside `docker-compose.yaml` under the `backend` service configuration: 
```
	backend: 
		... 
		# Uncomment next lines in docker-compose.yaml to achieve data persistance after the container is restarted.
		# Keep in mind that if this file does not exists, it will be created and mounted as the directory. 
		# To create it run: $ touch ./backend/local.db (while inside the root of the project).
		volumes: 
			-  ./backend/local.db:/app/local.db
```
If default parameters are used, after the startup (running `docker compose up`)  web application can be accessed in the browser on the address `http://localhost:3000`. 

HTTP REST API exposed by the backend service is described in `Order.Vega.postman_collection.json
` file, exported from the `Postman`. To use all of the routes described one has to create account first. This can be achieved by using `/auth/sign_up` route and occasionally `/auth/refresh_token` (auth token generated by the Supertokens will expire after some time). 

### Web application

#### Credentials
On top of the screen Login button will be present (if the user is already logged in) or user information in the form of `user@mail.com at users's address` together with the Logout button. 
Click on login button will open popup containing Supertokens signin/up form. In order to signUp, unique email address, password and address are required. To simplify the process, only the email is validated (by uniqueness but not existance).  

Each user can have `admin` role at any of the chains which enables him to add/update restaurants or couriers. This role is assigned using add_role route while providing `rootKey` to achieve required privileges. To simplify process every value provided is considered as valid `rootKey`.

#### Chains, restaurants, orders
In the first column, three available chains will appear. More can be load by clicking on `Load more` button in the bottom of the screen. Only 3 are loaded by default to showcase the paging feature. 
By selecting one of the chains, middle column will get populated by the available menu items.

If the current user has `admin` role for selected chain, admin panel will appear above the chains column enabling updates on restaurants or couriers. 
In `resturant` add/update menu, after the restaurant name is entered if such restaurant exists, `upate` and `delete` actions will appear, contrary only the add option will be available. 

 In `courier` add/update menu, restaurant list will be shown. By selecting restaurant available couriers will appear. Couriers can be removed by clicking on the `x` button next to them (if courier is not doing delivery) or added just by typing the email in the input field (if requested courier is not already assigned).

Similar actions are provided for menu items in `menu item` menu.
#### Reviews
If the user have ordered some of the menu items (but also never before have left the review), form for leaving review will appear on those menu items.
If reviews are available, the first one will be shown while the rest can be loaded by clicking on More review button (loading three more each time).
#### Checkout
By ordering menu item, it will get listed in the far bottom right column. Multiple items of the same kind can be added and each will get listed separately. While ordering user can switch restaurant chain and create order with items from multiple different chains. In the `total` column (above the ordered items) checkout will be available for each restaurant chain. By clicking checkout popup will open allowing user to enter credit card details (in form of the single string also always validated to simplify the process) and post the order. If any of the couriers is available order will be accepted and checkout item will be replaced with order info and `waiting` status (disappearing if page is refreshed after 15 min).

